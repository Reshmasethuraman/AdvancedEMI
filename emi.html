<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>EMI Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet">
  <style>
    .emi-output .display-6 {
      font-size: 2.5rem;
      font-weight: bold;
    }
    .bg-light-box {
      background-color: #f8f9fa;
      padding: 0.5rem;
      border-radius: 0.25rem;
      font-weight: 500;
    }
  </style>
</head>
<body>
<div class="container my-5">
  <div class="card shadow-sm p-4">
    <div class="row">
      <!-- Inputs Left -->
      <div class="col-md-6">
        <!-- Loan Amount -->
        <div class="mb-3">
          <label class="form-label">Loan Amount</label>
          <div class="d-flex align-items-center gap-2">
            <input type="number" id="loanAmountInput" class="form-control" min="100000" max="5000000" step="10000" value="1000000">
            <input type="range" id="loanAmountRange" class="form-range" min="100000" max="5000000" step="10000" value="1000000">
          </div>
          <div class="bg-light-box mt-2" id="loanAmountDisplay">₹10,00,000</div>
        </div>

        <!-- Interest Rate -->
        <div class="mb-3">
          <label class="form-label">Interest Rate (p.a)</label>
          <div class="d-flex align-items-center gap-2">
            <input type="number" id="interestRateInput" class="form-control" min="1" max="30" step="0.1" value="7.5">
            <input type="range" id="interestRateRange" class="form-range" min="1" max="30" step="0.1" value="7.5">
          </div>
          <div class="bg-light-box mt-2" id="interestRateDisplay">7.5%</div>
        </div>

        <!-- Loan Tenure -->
        <div class="mb-3">
          <label class="form-label">Loan Tenure (Years)</label>
          <div class="d-flex align-items-center gap-2">
            <input type="number" id="loanTenureInput" class="form-control" min="1" max="30" value="5">
            <input type="range" id="loanTenureRange" class="form-range" min="1" max="30" value="5">
          </div>
          <div class="bg-light-box mt-2" id="loanTenureDisplay">5 Yr</div>
        </div>
      </div>

      <!-- EMI Output -->
      <div class="col-md-6 d-flex flex-column justify-content-center emi-output">
        <div class="border border-success rounded overflow-hidden">
          <div class="bg-success bg-opacity-10 text-center py-3">
            <div class="text-muted">Your Monthly EMI Payment</div>
            <div class="text-success display-6" id="emiDisplay">₹0</div>
          </div>
          <div class="p-4">
            <div class="d-flex justify-content-between mb-2">
              <div>Principal Amount</div>
              <div id="principalDisplay">₹0</div>
            </div>
            <div class="d-flex justify-content-between mb-2">
              <div>Total Interest</div>
              <div id="interestDisplay">₹0</div>
            </div>
            <hr />
            <div class="d-flex justify-content-between fw-bold">
              <div>Total Amount</div>
              <div id="totalDisplay">₹0</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Amortization Section -->
    <div class="text-center mt-4">
      <button class="btn btn-success" id="toggleAmortization">Amortization Details</button>
    </div>
    <div class="mt-4 d-none" id="amortizationSection">
      <div id="amortizationAccordion" class="accordion"></div>
      <div class="text-center mt-2">
        <button class="btn btn-outline-primary" id="toggleMoreYears">Show More</button>
      </div>
    </div>
  </div>
</div>

<script>
  const formatINR = num =>
    new Intl.NumberFormat("en-IN", { style: "currency", currency: "INR", maximumFractionDigits: 0 }).format(Math.round(num));

  const loanAmountInput = document.getElementById("loanAmountInput");
  const loanAmountRange = document.getElementById("loanAmountRange");
  const interestRateInput = document.getElementById("interestRateInput");
  const interestRateRange = document.getElementById("interestRateRange");
  const loanTenureInput = document.getElementById("loanTenureInput");
  const loanTenureRange = document.getElementById("loanTenureRange");

  const emiDisplay = document.getElementById("emiDisplay");
  const principalDisplay = document.getElementById("principalDisplay");
  const interestDisplay = document.getElementById("interestDisplay");
  const totalDisplay = document.getElementById("totalDisplay");

  const loanAmountDisplay = document.getElementById("loanAmountDisplay");
  const interestRateDisplay = document.getElementById("interestRateDisplay");
  const loanTenureDisplay = document.getElementById("loanTenureDisplay");

  let showYears = 4;
  let scheduleGlobal = {};

  function syncInputs(input1, input2, display, suffix = "") {
    input1.addEventListener("input", () => {
      input2.value = input1.value;
      display.innerText = suffix ? input1.value + suffix : formatINR(input1.value);
      updateEMI();
    });
    input2.addEventListener("input", () => {
      input1.value = input2.value;
      display.innerText = suffix ? input2.value + suffix : formatINR(input2.value);
      updateEMI();
    });
  }

  function calculateEMI(P, R, N) {
    const r = R / 12 / 100;
    const n = N * 12;
    const emi = (P * r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
    return emi;
  }

  function generateSchedule(P, R, N) {
    const r = R / 12 / 100;
    const n = N * 12;
    const emi = calculateEMI(P, R, N);
    let balance = P;
    const schedule = {};
    for (let i = 0; i < n; i++) {
      const interest = balance * r;
      const principal = emi - interest;
      balance -= principal;
      const date = new Date();
      date.setMonth(date.getMonth() + i);
      const year = date.getFullYear();
      const month = date.toLocaleString("default", { month: "short" });
      if (!schedule[year]) schedule[year] = [];
      schedule[year].push({ month, emi, principal, interest, balance });
    }
    return schedule;
  }

  function updateEMI() {
    const P = Number(loanAmountInput.value);
    const R = Number(interestRateInput.value);
    const N = Number(loanTenureInput.value);
    const emi = calculateEMI(P, R, N);
    const totalPayment = emi * N * 12;
    const totalInterest = totalPayment - P;
    emiDisplay.innerText = formatINR(emi);
    principalDisplay.innerText = formatINR(P);
    interestDisplay.innerText = formatINR(totalInterest);
    totalDisplay.innerText = formatINR(totalPayment);
  }

  function toggleAmortizationTable() {
    const section = document.getElementById("amortizationSection");
    section.classList.toggle("d-none");
    scheduleGlobal = generateSchedule(
      Number(loanAmountInput.value),
      Number(interestRateInput.value),
      Number(loanTenureInput.value)
    );
    showYears = 4;
    populateAmortization();
  }

  function populateAmortization() {
    const container123 = document.getElementById("amortizationAccordion");
    container123.innerHTML = "";
    const years = Object.keys(scheduleGlobal);
    const visibleYears = years.slice(0, showYears);

    visibleYears.forEach((year, index) => {
      const collapseId = `collapse${index}`;
      const entries = scheduleGlobal[year];
      const rows = entries.map(
        (e) =>
          `<tr><td>${e.month}</td><td>${formatINR(e.principal)}</td><td>${formatINR(e.interest)}</td><td>${formatINR(e.emi)}</td><td>${formatINR(e.balance)}</td></tr>`
      ).join("");

      container123.innerHTML += `
        <div class="accordion-item">
          <h2 class="accordion-header" id="heading${index}">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#${collapseId}">
              ${year}
            </button>
          </h2>
          <div id="${collapseId}" class="accordion-collapse collapse">
            <div class="accordion-body">
              <table class="table table-sm table-bordered">
                <thead><tr><th>Month</th><th>Principal</th><th>Interest</th><th>EMI</th><th>Balance</th></tr></thead>
                <tbody>${rows}</tbody>
              </table>
            </div>
          </div>
        </div>`;
    });

    const toggleBtn = document.getElementById("toggleMoreYears");
    if (showYears >= years.length) {
      toggleBtn.innerText = "Show Less";
    } else {
      toggleBtn.innerText = "Show More";
    }
  }

  function toggleMoreYears() {
    const totalYears = Object.keys(scheduleGlobal).length;
    if (showYears >= totalYears) {
      showYears = 4;
    } else {
      showYears += 4;
    }
    populateAmortization();
  }

  // Initialize
  syncInputs(loanAmountInput, loanAmountRange, loanAmountDisplay);
  syncInputs(interestRateInput, interestRateRange, interestRateDisplay, "%");
  syncInputs(loanTenureInput, loanTenureRange, loanTenureDisplay, " Yr");
  updateEMI();

  document.getElementById("toggleAmortization").addEventListener("click", toggleAmortizationTable);
  document.getElementById("toggleMoreYears").addEventListener("click", toggleMoreYears);
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>


